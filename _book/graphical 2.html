<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Biostatics for Public Health - 3&nbsp; Graphical Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./estimation.html" rel="next">
<link href="./descriptives.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./intro.html">Fundamentals</a></li><li class="breadcrumb-item"><a href="./graphical.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Graphical Analysis</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Biostatics for Public Health</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Fundamentals</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Data Manipulation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./descriptives.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Descriptive Statistics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./graphical.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Graphical Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./estimation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Introduction to Inferential Statistics</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Regression Methods</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview"><span class="header-section-number">3.1</span> Overview</a></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction"><span class="header-section-number">3.2</span> Introduction</a>
  <ul class="collapse">
  <li><a href="#extensions-and-links" id="toc-extensions-and-links" class="nav-link" data-scroll-target="#extensions-and-links"><span class="header-section-number">3.2.1</span> Extensions and links</a></li>
  </ul></li>
  <li><a href="#distributions" id="toc-distributions" class="nav-link" data-scroll-target="#distributions"><span class="header-section-number">3.3</span> Distributions</a>
  <ul class="collapse">
  <li><a href="#histograms" id="toc-histograms" class="nav-link" data-scroll-target="#histograms"><span class="header-section-number">3.3.1</span> Histograms</a></li>
  <li><a href="#density-plots" id="toc-density-plots" class="nav-link" data-scroll-target="#density-plots"><span class="header-section-number">3.3.2</span> Density plots</a></li>
  <li><a href="#qq-plots" id="toc-qq-plots" class="nav-link" data-scroll-target="#qq-plots"><span class="header-section-number">3.3.3</span> QQ-plots</a></li>
  </ul></li>
  <li><a href="#associations-between-continuous-variables" id="toc-associations-between-continuous-variables" class="nav-link" data-scroll-target="#associations-between-continuous-variables"><span class="header-section-number">3.4</span> Associations between continuous variables</a>
  <ul class="collapse">
  <li><a href="#scatter-plots" id="toc-scatter-plots" class="nav-link" data-scroll-target="#scatter-plots"><span class="header-section-number">3.4.1</span> Scatter plots</a></li>
  <li><a href="#scatter-plot-matrix-supplementary-optional-sub-section" id="toc-scatter-plot-matrix-supplementary-optional-sub-section" class="nav-link" data-scroll-target="#scatter-plot-matrix-supplementary-optional-sub-section"><span class="header-section-number">3.4.2</span> Scatter plot matrix (supplementary, optional sub-section)</a></li>
  <li><a href="#correlation-plots" id="toc-correlation-plots" class="nav-link" data-scroll-target="#correlation-plots"><span class="header-section-number">3.4.3</span> Correlation plots</a></li>
  <li><a href="#line-charts" id="toc-line-charts" class="nav-link" data-scroll-target="#line-charts"><span class="header-section-number">3.4.4</span> Line charts</a></li>
  <li><a href="#kaplan-meier-plots" id="toc-kaplan-meier-plots" class="nav-link" data-scroll-target="#kaplan-meier-plots"><span class="header-section-number">3.4.5</span> Kaplan-Meier plots</a></li>
  </ul></li>
  <li><a href="#comparing-groups" id="toc-comparing-groups" class="nav-link" data-scroll-target="#comparing-groups"><span class="header-section-number">3.5</span> Comparing groups</a>
  <ul class="collapse">
  <li><a href="#box-plots" id="toc-box-plots" class="nav-link" data-scroll-target="#box-plots"><span class="header-section-number">3.5.1</span> Box plots</a></li>
  <li><a href="#significant-lines-supplementary-optional-sub-section" id="toc-significant-lines-supplementary-optional-sub-section" class="nav-link" data-scroll-target="#significant-lines-supplementary-optional-sub-section"><span class="header-section-number">3.5.2</span> Significant lines (supplementary, optional sub-section)</a></li>
  <li><a href="#strip-charts" id="toc-strip-charts" class="nav-link" data-scroll-target="#strip-charts"><span class="header-section-number">3.5.3</span> Strip charts</a></li>
  <li><a href="#violin-plots-supplementary-optional-sub-section" id="toc-violin-plots-supplementary-optional-sub-section" class="nav-link" data-scroll-target="#violin-plots-supplementary-optional-sub-section"><span class="header-section-number">3.5.4</span> Violin plots (supplementary, optional sub-section)</a></li>
  <li><a href="#bar-charts" id="toc-bar-charts" class="nav-link" data-scroll-target="#bar-charts"><span class="header-section-number">3.5.5</span> Bar charts</a></li>
  </ul></li>
  <li><a href="#exporting-figures" id="toc-exporting-figures" class="nav-link" data-scroll-target="#exporting-figures"><span class="header-section-number">3.6</span> Exporting figures</a>
  <ul class="collapse">
  <li><a href="#postscript-figures" id="toc-postscript-figures" class="nav-link" data-scroll-target="#postscript-figures"><span class="header-section-number">3.6.1</span> Postscript figures</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Graphical Analysis</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rstatix)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(easystats)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggfortify)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jtools)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pubh)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sjlabelled)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sjPlot)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sjmisc)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggsci)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>import<span class="sc">::</span><span class="fu">from</span>(latex2exp, TeX)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>import<span class="sc">::</span><span class="fu">from</span>(epiDisplay, ci)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(sjPlot<span class="sc">::</span><span class="fu">theme_sjplot2</span>(<span class="at">base_size =</span> <span class="dv">10</span>))</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_update</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>)</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="st">'huxtable.knit_print_df'</span> <span class="ot">=</span> <span class="cn">FALSE</span>)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="st">'huxtable.autoformat_number_format'</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="at">numeric =</span> <span class="st">"%5.2f"</span>))</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">dpi =</span> <span class="dv">300</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="overview" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="overview"><span class="header-section-number">3.1</span> Overview</h2>
<p>It would be impossible to cover all possible <code>R</code> graphs in this laboratory, let alone all the useful options for each type of graph, so we will focus on identifying the main types of graphs and look at some commonly used options. Once you have mastered the basic principles covered in this laboratory, you should be well prepared to construct basic graphs.</p>
<p>This lab has several optional sections, you are welcome to do to those sections or simply use them as a reference for making plots.</p>
<p>Once you have completed this lab, you should feel comfortable:</p>
<ul>
<li>Constructing histograms and density plots.</li>
<li>Constructing scatter plots (both bivariate and matrix) and line charts.</li>
<li>Constructing box plots.</li>
<li>Constructing QQ-plots.</li>
<li>Constructing strip charts.</li>
<li>Constructing bar charts.</li>
<li>Adding titles and labels to these graphs.</li>
<li>Customising these graphs by setting appropriate options.</li>
<li>Exporting plots for publications or other purposes.</li>
</ul>
<blockquote class="blockquote">
<p><strong>Summary of New Commands</strong></p>
</blockquote>
<table class="table">
<colgroup>
<col style="width: 25%">
<col style="width: 15%">
<col style="width: 59%">
</colgroup>
<thead>
<tr class="header">
<th><strong>Command</strong></th>
<th><strong>Library</strong></th>
<th><strong>Function</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>autoplot</strong></td>
<td><em>ggplot2</em></td>
<td>Plots objects from different classes</td>
</tr>
<tr class="even">
<td><strong>axis_labs</strong></td>
<td><em>pubh</em></td>
<td>Uses labels from labelled data for axis legends</td>
</tr>
<tr class="odd">
<td><strong>bar_error</strong></td>
<td><em>pubh</em></td>
<td>Constructs bar charts with error bars</td>
</tr>
<tr class="even">
<td><strong>box_plot</strong></td>
<td><em>pubh</em></td>
<td>Constructs box-plots</td>
</tr>
<tr class="odd">
<td><strong>correlation</strong></td>
<td><em>correlation</em></td>
<td>Estimates correlation coefficients</td>
</tr>
<tr class="even">
<td><strong>dev.off</strong></td>
<td><em>grDevices</em></td>
<td>Closes the current graphing device</td>
</tr>
<tr class="odd">
<td><strong>get_label</strong></td>
<td><em>sjlabelled</em></td>
<td>Retrieves variable label</td>
</tr>
<tr class="even">
<td><strong>gf_counts</strong></td>
<td><em>ggformula</em></td>
<td>Constructs bar plots (using counts)</td>
</tr>
<tr class="odd">
<td><strong>gf_dens</strong></td>
<td><em>ggformula</em></td>
<td>Constructs density plots (contour)</td>
</tr>
<tr class="even">
<td><strong>gf_density</strong></td>
<td><em>ggformula</em></td>
<td>Constructs density plots (filled)</td>
</tr>
<tr class="odd">
<td><strong>gf_dhistogram</strong></td>
<td><em>ggformula</em></td>
<td>Constructs histograms in terms of density</td>
</tr>
<tr class="even">
<td><strong>gf_histogram</strong></td>
<td><em>ggformula</em></td>
<td>Constructs histograms in terms of frequency</td>
</tr>
<tr class="odd">
<td><strong>gf_jitter</strong></td>
<td><em>ggformula</em></td>
<td>Constructs strip charts</td>
</tr>
<tr class="even">
<td><strong>gf_line</strong></td>
<td><em>ggformula</em></td>
<td>Constructs line charts</td>
</tr>
<tr class="odd">
<td><strong>gf_labs</strong></td>
<td><em>ggformula</em></td>
<td>Edits plot’s labels (axis, mains, facets)</td>
</tr>
<tr class="even">
<td><strong>gf_lm</strong></td>
<td><em>ggformula</em></td>
<td>Fits a simple linear model to a scatter plot</td>
</tr>
<tr class="odd">
<td><strong>gf_point</strong></td>
<td><em>ggformula</em></td>
<td>Constructs scatter plots</td>
</tr>
<tr class="even">
<td><strong>gf_refine</strong></td>
<td><em>ggformula</em></td>
<td>Used to change scales and theme in a plot</td>
</tr>
<tr class="odd">
<td><strong>gf_smooth</strong></td>
<td><em>ggformula</em></td>
<td>Adds a loess fit (trend) to a scatter plot</td>
</tr>
<tr class="even">
<td><strong>gf_star</strong></td>
<td><em>pubh</em></td>
<td>Adds a significant line for annotating plots</td>
</tr>
<tr class="odd">
<td><strong>gf_summary</strong></td>
<td><em>ggformula</em></td>
<td>Aggregates data by statistics to add to a plot</td>
</tr>
<tr class="even">
<td><strong>gf_theme</strong></td>
<td><em>ggformula</em></td>
<td>Changes aspects of the theme</td>
</tr>
<tr class="odd">
<td><strong>gf_violin</strong></td>
<td><em>ggformula</em></td>
<td>Constructs violin plots</td>
</tr>
<tr class="even">
<td><strong>ggpairs</strong></td>
<td><em>GGally</em></td>
<td>Constructs scatter plot matrices</td>
</tr>
<tr class="odd">
<td><strong>his_norm</strong></td>
<td><em>pubh</em></td>
<td>Constructs histograms with normal curve</td>
</tr>
<tr class="even">
<td><strong>na.omit</strong></td>
<td><em>stats</em></td>
<td>Removes observations with missing values from a dataset</td>
</tr>
<tr class="odd">
<td><strong>pdf</strong></td>
<td><em>grDevices</em></td>
<td>Exports figures as PDF</td>
</tr>
<tr class="even">
<td><strong>pivot_longer</strong></td>
<td><em>dplyr</em></td>
<td>Transforms data from wide to long format</td>
</tr>
<tr class="odd">
<td><strong>plot_scatter</strong></td>
<td><em>sjPlot</em></td>
<td>Constructs scatter plots</td>
</tr>
<tr class="even">
<td><strong>postscript</strong></td>
<td><em>grDevices</em></td>
<td>Exports figures as EPS files</td>
</tr>
<tr class="odd">
<td><strong>qq_plot</strong></td>
<td><em>pubh</em></td>
<td>Constructs QQ-plots</td>
</tr>
<tr class="even">
<td><strong>remove_all_labels</strong></td>
<td><em>sjlabelled</em></td>
<td>Removes labels from a dataset</td>
</tr>
<tr class="odd">
<td><strong>sjplot</strong></td>
<td><em>sjPlot</em></td>
<td>Constructs plots using pipe-workflow</td>
</tr>
<tr class="even">
<td><strong>stat_compare_means</strong></td>
<td><em>ggpubr</em></td>
<td>Adds a significant line for annotating plots</td>
</tr>
<tr class="odd">
<td><strong>strip_error</strong></td>
<td><em>pubh</em></td>
<td>Constructs strip plots with error bars</td>
</tr>
</tbody>
</table>
</section>
<section id="introduction" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="introduction"><span class="header-section-number">3.2</span> Introduction</h2>
<p>Chapter 4 of <span class="citation" data-cites="iswr">(<a href="references.html#ref-iswr" role="doc-biblioref">Dalgaard 2008</a>)</span> shows how to do basic descriptive statistics, as well as the classic plots in <code>R</code>. There are more graphic packages that allow better graphics, one of them is <code>ggplot2</code> whose syntax is relatively complex. We will be using the package <code>ggformula</code> which simplifies syntax for constructing plots with <code>ggplot2</code> using formulas as part of its syntax. The package is loaded in the system when you load the <code>pubh</code> package.</p>
<p>There are different reasons to make a plot. For manuscripts and reports, plots in black and white (B&amp;W) are sometimes preferred (as figures in colour have an extra cost). However, if you want to show your plots in a presentation or a poster, a colour would be more appropriate.</p>
<p><strong>For manuscripts</strong></p>
<ol type="1">
<li>Include figure legends (captions).</li>
<li>The <em>main</em> title is not included in the plot but as part of the description in the legend.</li>
<li>Use B&amp;W plots, you can use any variation of grey.</li>
<li>Export the plot as a <code>.eps</code> or <code>.pdf</code> file (see last section).</li>
</ol>
<p><strong>For reports, including assignments</strong></p>
<ol type="1">
<li>Include figure legends (captions).</li>
<li>The <em>main</em> title is not included in the plot but as part of the description in the legend.</li>
<li>You can play with colours, but be smart, e.g., avoid bright colours.</li>
</ol>
<p><strong>For presentations</strong></p>
<ol type="1">
<li>Do not include long legends.</li>
<li>Use a medium to large font so audience can read your legends.</li>
<li>Include a main title for the plot.</li>
<li>Use colours!</li>
<li>Include extra information to explain the plot, or make sure that you explain well your plot in your presentation.</li>
<li>Export the plot as a <code>.pdf</code> or <code>.png</code> file (see last section).</li>
</ol>
<p>We will use the <code>wcgs</code> dataset as an example of a relatively large data, the <code>kfm</code> dataset as an example of a relatively small data and the <code>birthwt</code> as an example of medium size data.</p>
<p>First we load datasets that we have saved in previous labs:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>wcgs <span class="ot">=</span> <span class="fu">read_rds</span>(<span class="st">'data/wcgs.rds'</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>kfm <span class="ot">=</span> <span class="fu">read_rds</span>(<span class="st">'data/kfm.rds'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we load the <code>birthwt</code> dataset from the <code>MASS</code> package, generate factors and assign labels.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(birthwt, <span class="at">package =</span> <span class="st">"MASS"</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>birthwt <span class="ot">=</span> <span class="fu">as_tibble</span>(birthwt)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>birthwt <span class="ot">=</span> birthwt <span class="sc">%&gt;%</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">low =</span> <span class="fu">factor</span>(low, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"No"</span>, <span class="st">"Yes"</span>)),</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">lwt =</span> lwt <span class="sc">*</span> <span class="fl">0.4536</span>,</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">smoke =</span> <span class="fu">factor</span>(smoke, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Non-smoker"</span>, <span class="st">"Smoker"</span>)),</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">Race =</span> <span class="fu">factor</span>(race <span class="sc">&gt;</span> <span class="dv">1</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"White"</span>, <span class="st">"Non-white"</span>)),</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">race =</span> <span class="fu">factor</span>(race, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"White"</span>, <span class="st">"African-American"</span>, <span class="st">"Other"</span>)),</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">ht =</span> <span class="fu">factor</span>(ht, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"No"</span>, <span class="st">"Yes"</span>)),</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">ui =</span> <span class="fu">factor</span>(ui, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"No"</span>, <span class="st">"Yes"</span>))</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">var_labels</span>(</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">low =</span> <span class="st">"Birth weight less than 2.5 kg"</span>,</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">age =</span> <span class="st">"Mother's age (years)"</span>,</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">lwt =</span> <span class="st">"Mother's weight (kg)"</span>,</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">bwt =</span> <span class="st">'Birth weight (g)'</span>,</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">smoke =</span> <span class="st">'Smoking status'</span>,</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">race =</span> <span class="st">"Mother's race"</span>,</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">ptl =</span> <span class="st">"Premature labours"</span>,</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">ht =</span> <span class="st">"Hypertension"</span>,</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">ui =</span> <span class="st">"Uterine irritability"</span>,</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(birthwt, <span class="st">"data/birthwt.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="extensions-and-links" class="level3" data-number="3.2.1">
<h3 data-number="3.2.1" class="anchored" data-anchor-id="extensions-and-links"><span class="header-section-number">3.2.1</span> Extensions and links</h3>
<p>For this lab, we are going to load some packages that extend functions from <code>ggplot2</code>.</p>
<ul>
<li>Functions in <code>ggsci</code> are really optional as they provide palettes used in journals.</li>
<li>Functions in <code>GGaly</code> are just for special cases, like scatter plot matrices.</li>
<li>Functions in <code>ggpubr</code> are intended for publication purposes.</li>
<li>Functions in <code>plotly</code> allow to interact with the plots.</li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>External links</strong></p>
<ul>
<li>More information on <code>ggformula</code>, including tutorials, can be found <a href="https://projectmosaic.github.io/ggformula/index.html">here</a>.</li>
<li>Examples for <code>ggpubr</code> can be found <a href="https://rpkgs.datanovia.com/ggpubr/">here</a>.</li>
<li>Examples for <code>GGally</code> can be found <a href="http://ggobi.github.io/ggally/index.html">here</a>.</li>
<li>Examples about axis scales and transformations can be found <a href="http://www.sthda.com/english/wiki/ggplot2-axis-scales-and-transformations">here</a>.</li>
</ul>
</div>
</div>
</section>
</section>
<section id="distributions" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="distributions"><span class="header-section-number">3.3</span> Distributions</h2>
<p>As part of the descriptive analysis, it is important to understand the distribution of continuous outcomes. For relatively large datasets, histograms and density plots are appropriate.</p>
<section id="histograms" class="level3" data-number="3.3.1">
<h3 data-number="3.3.1" class="anchored" data-anchor-id="histograms"><span class="header-section-number">3.3.1</span> Histograms</h3>
<p>We use histograms to look at the distribution of continuous variables. Histograms make most sense for relatively large data (<span class="math inline">\(\geq\)</span> 100 observations). The <code>ggformula</code> package uses <em>formulas</em>; in the case of histograms, there is no left-hand side (as it was the case of <code>estat</code>). For example, for plotting the histogram of systolic blood pressure we type:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>wcgs <span class="sc">%&gt;%</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gf_histogram</span>( <span class="sc">~</span> sbp, <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">"pink"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="graphical_files/figure-html/fig-fig1-1.png" class="img-fluid figure-img" width="1800"></p>
<figcaption class="figure-caption">Figure&nbsp;3.1: Histogram of systolic blood pressure (SBP) for the WCGS dataset.</figcaption>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>The bars are not at the centre of the plot, that means we have cases (very few of them) with high values of cholesterol. In other words, the distribution is clearly skewed to the right (i.e., with a positive skew).</p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>At the start of the code, the first two lines (hidden on the final document) are:</li>
</ol>
<ul>
<li><code>#| label: fig-fig1</code></li>
<li><code>#| fig-cap: "Histogram of systolic blood pressure (SBP) for the WCGS dataset."</code></li>
</ul>
<ol start="2" type="1">
<li>The label (name) of the chunk is: <code>fig-fig1</code>. When the label starts with <code>fig-</code>, the figure is automatically numbered. To refer to <a href="#fig-fig1">Figure&nbsp;<span>3.1</span></a> in the document we type: <code>@fig-fig1</code>.</li>
<li>The option <code>col</code> refers to the colour of the lines defining the bars; the option <code>fill</code> refers to the colour inside the bars.</li>
<li>You can look at the list of colours available by typing <code>colors()</code> in the <em>Console</em> panel.</li>
</ol>
</div>
</div>
<p>In our first plot, the <span class="math inline">\(y\)</span>-axis shows the frequency (counts), we may want to show the density (proportion) instead. Densities are preferred when comparing two or more distributions. To choose density we use <code>gf_dhistogram</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>wcgs <span class="sc">%&gt;%</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gf_dhistogram</span>(<span class="sc">~</span> sbp, <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">"plum3"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="graphical_files/figure-html/fig-fig2-1.png" class="img-fluid figure-img" width="1800"></p>
<figcaption class="figure-caption">Figure&nbsp;3.2: Histograms of systolic blood pressure (SBP) for the WCGS dataset.</figcaption>
</figure>
</div>
</div>
</div>
<p>We can compare groups using the <code>|</code> symbol, which can be understood as <em>given</em> or <em>by</em>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>wcgs <span class="sc">%&gt;%</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gf_dhistogram</span>(<span class="sc">~</span> sbp<span class="sc">|</span>chd, <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">"slategray3"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig3" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="graphical_files/figure-html/fig-fig3-1.png" class="img-fluid figure-img" width="1800"></p>
<figcaption class="figure-caption">Figure&nbsp;3.3: Histogram of systolic blood pressure (SBP) by coronary heart disease (CHD) event for the WCGS dataset.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="density-plots" class="level3" data-number="3.3.2">
<h3 data-number="3.3.2" class="anchored" data-anchor-id="density-plots"><span class="header-section-number">3.3.2</span> Density plots</h3>
<p>An alternative to histograms is density plots.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>birthwt <span class="sc">%&gt;%</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gf_dens</span>(<span class="sc">~</span> bwt, <span class="at">col =</span> <span class="st">"cadetblue"</span>, <span class="at">lwd =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig4" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="graphical_files/figure-html/fig-fig4-1.png" class="img-fluid figure-img" width="1800"></p>
<figcaption class="figure-caption">Figure&nbsp;3.4: Distribution of birth weight.</figcaption>
</figure>
</div>
</div>
</div>
<p>We can use superimposed density plots to compare distributions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>birthwt <span class="sc">%&gt;%</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gf_density</span>(<span class="sc">~</span> bwt, <span class="at">fill =</span> <span class="sc">~</span> smoke, <span class="at">alpha =</span> <span class="fl">0.3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig5" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="graphical_files/figure-html/fig-fig5-1.png" class="img-fluid figure-img" width="1800"></p>
<figcaption class="figure-caption">Figure&nbsp;3.5: Comparison of birth weight distributions by mother’s smoking status.</figcaption>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>In the previous code, instead of displaying the distributions in two different panels (<em>faceting</em>) as we did with histograms, we are displaying them in the same panel but super-imposed.</li>
<li>By using the option <code>fill = ~ smoke</code>, we are telling <code>R</code> to select filling colours according to levels in the variable <code>smoke</code>.</li>
<li>With <code>alpha</code> we reduce the opacity, thus increase the transparency.</li>
<li>With <code>gf_dens</code> we plot only the contour whereas with <code>gf_density</code> the area under the curve is filled.</li>
</ol>
</div>
</div>
<p>If you use the template from the <code>pubh</code> package, legends are placed on <em>top</em> of the plot. To specify a different location, we can use the argument <code>legend.position</code> in <code>gf_theme</code>. With <code>legend.position</code> we can either specify a side of the plot (e.g.&nbsp;<code>"right"</code>) or give relative coordinates. For example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>birthwt <span class="sc">%&gt;%</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gf_density</span>(<span class="sc">~</span> bwt<span class="sc">|</span>smoke, <span class="at">fill =</span> <span class="sc">~</span> race, <span class="at">alpha=</span><span class="fl">0.3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gf_theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.12</span>, <span class="fl">0.85</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig6" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="graphical_files/figure-html/fig-fig6-1.png" class="img-fluid figure-img" width="1800"></p>
<figcaption class="figure-caption">Figure&nbsp;3.6: Comparison of birth weight distributions by smoking status of the mother and race of the mother.</figcaption>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>Coordinates are given as <code>c(x, y)</code>, where values of <code>x</code> and <code>y</code> go from 0 to 1 and represent a proportion in the corresponding axis.</p>
</div>
</div>
<p>To help on the interpretation of histograms, we can impose a <em>density</em> plot derived from a population with the same mean and standard deviation of the variable of interest. To make this plot, we can use the function <code>hist_norm</code> from the <code>pubh</code> package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>wcgs <span class="sc">%&gt;%</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hist_norm</span>(<span class="sc">~</span> sbp, <span class="at">bins =</span> <span class="dv">30</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig7" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="graphical_files/figure-html/fig-fig7-1.png" class="img-fluid figure-img" width="1800"></p>
<figcaption class="figure-caption">Figure&nbsp;3.7: Histogram of systolic blood pressure (SBP) for the WCGS dataset. The black curve represents a density plot from a normal distribution.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="qq-plots" class="level3" data-number="3.3.3">
<h3 data-number="3.3.3" class="anchored" data-anchor-id="qq-plots"><span class="header-section-number">3.3.3</span> QQ-plots</h3>
<p>The best way to determine if a continuous variable is normally distributed or not is with quantile-quantile plots (QQ-plots). We plot the quantiles of our variable of interest against quantiles from the standard normal distribution (which has a mean <span class="math inline">\(\mu=0\)</span> and a standard deviation <span class="math inline">\(\sigma=1\)</span>). This type of QQ-plots against the normal distribution are known as QQ-normal plots. If the variable is normally distributed, then a linear relationship will be observed.</p>
<p>To construct a QQ-plot we can use the function <code>qq_plot</code> from the <code>pubh</code> package. QQ-plots can be used even for relatively small samples.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>kfm <span class="sc">%&gt;%</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">qq_plot</span>(<span class="sc">~</span> dl.milk) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig8" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="graphical_files/figure-html/fig-fig8-1.png" class="img-fluid figure-img" width="1800"></p>
<figcaption class="figure-caption">Figure&nbsp;3.8: QQ-plot of breast-milk intake against the normal distribution.</figcaption>
</figure>
</div>
</div>
</div>
<p>We can use <code>plots</code> to display more than one plot in a grid:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">=</span> kfm <span class="sc">%&gt;%</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gf_dens</span>(<span class="sc">~</span> dl.milk, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">axis_labs</span>()</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">=</span> kfm <span class="sc">%&gt;%</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">qq_plot</span>(<span class="sc">~</span> dl.milk) <span class="sc">%&gt;%</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">axis_labs</span>()</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plots</span>(p1, p2, <span class="at">n_columns =</span> <span class="dv">2</span>, <span class="at">tags =</span> <span class="st">"a"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig9" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="graphical_files/figure-html/fig-fig9-1.png" class="img-fluid figure-img" width="1800"></p>
<figcaption class="figure-caption">Figure&nbsp;3.9: Distribution of breast-milk intake in infants. (a) Density plot. (b) QQ-plot against the normal distribution.</figcaption>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>The argument <code>n_columns = 2</code> is used to display the two plots on the same row. By default <code>n_columns = 1</code>.</li>
<li>With <code>tags = "a"</code> we are using lower case auto caption.</li>
<li>We need to include axis_labs when we display more than one plot as <code>ggormula</code> does not longer recognise the original label of the variable.</li>
</ol>
</div>
</div>
<p>A variable that is positive-skewed is <span class="math inline">\(J\)</span>-shaped in a QQ-plot.</p>
<blockquote class="blockquote">
<p><strong>Exercise:</strong> Using a QQ-plot, determine if SBP from normal subjects (no CHD event) in the <code>WCGS</code> dataset follows a normal distribution.</p>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>wcgs <span class="sc">%&gt;%</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(chd <span class="sc">==</span> <span class="st">"No CHD"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">copy_labels</span>(wcgs) <span class="sc">%&gt;%</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">qq_plot</span>(<span class="sc">~</span> sbp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig10" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="graphical_files/figure-html/fig-fig10-1.png" class="img-fluid figure-img" width="1800"></p>
<figcaption class="figure-caption">Figure&nbsp;3.10: QQ-plot of systolic blood pressure (SBP) against the normal distribution, for subjects who did not present a coronary heart disease event in the WCGS dataset.</figcaption>
</figure>
</div>
</div>
</div>
<blockquote class="blockquote">
<p><strong>Answer:</strong> The QQ-plots shows that the distribution of SBP in control subjects is positive skewed.</p>
</blockquote>
</section>
</section>
<section id="associations-between-continuous-variables" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="associations-between-continuous-variables"><span class="header-section-number">3.4</span> Associations between continuous variables</h2>
<section id="scatter-plots" class="level3" data-number="3.4.1">
<h3 data-number="3.4.1" class="anchored" data-anchor-id="scatter-plots"><span class="header-section-number">3.4.1</span> Scatter plots</h3>
<p>We use scatter plots to look at the relationship between two continuous variables. By default, the dependent variable (response) is plotted on the <span class="math inline">\(y\)</span> axis while the independent variable (explanatory) is plotted on the <span class="math inline">\(x\)</span> axis.</p>
<p>From the <code>kfm</code> dataset, let’s see if there is a relationship between the weight of the mother and the breast-milk intake of the child.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>kfm <span class="sc">%&gt;%</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gf_point</span>(dl.milk <span class="sc">~</span> mat.weight, <span class="at">pch =</span> <span class="dv">16</span>, </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="sc">~</span> sex, <span class="at">size =</span> <span class="fl">1.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig11" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="graphical_files/figure-html/fig-fig11-1.png" class="img-fluid figure-img" width="1800"></p>
<figcaption class="figure-caption">Figure&nbsp;3.11: Relationship between maternal weight and breast-milk intake in infants.</figcaption>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <code>pch</code> argument in <code>gf_point</code> can be used to specify the symbol to plot the data. The default is <code>pch = 16</code> which uses filled circles.</p>
</div>
</div>
<p><a href="#fig-fig12">Figure&nbsp;<span>3.12</span></a> shows the most common symbols used in <code>R</code>. Symbols are defined with the option <code>pch</code>. For example, <code>pch = 17</code> would use filled triangles. You can also use symbols from the keyboard, for example <code>pch = "+"</code>, <code>pch = "o"</code>, <code>pch = "@"</code>, etc. When we have an enormous sample size, and we want to use a tiny symbol, we can type: <code>pch = "."</code>, alternatively, play with the option <code>size</code>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-fig12" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="graphical_files/figure-html/fig-fig12-1.png" class="img-fluid figure-img" width="1800"></p>
<figcaption class="figure-caption">Figure&nbsp;3.12: Common symbols used in <code>R</code>.</figcaption>
</figure>
</div>
</div>
</div>
<p>The advantage of <code>ggplot2</code> and <code>ggformula</code> is that plots can be extended and used for multivariate graphical analysis. For example, we could add a line representing a linear fit:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>kfm <span class="sc">%&gt;%</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gf_point</span>(dl.milk <span class="sc">~</span> mat.weight) <span class="sc">%&gt;%</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gf_lm</span>(<span class="at">interval =</span> <span class="st">"confidence"</span>, <span class="at">col =</span> <span class="st">"indianred"</span>, </span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">fill =</span> <span class="st">"indianred"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig13" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="graphical_files/figure-html/fig-fig13-1.png" class="img-fluid figure-img" width="1800"></p>
<figcaption class="figure-caption">Figure&nbsp;3.13: Relationship between maternal weight and breast-milk intake in infants.</figcaption>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>We use <code>gf_lm</code> to fit a linear model (<code>lm</code>) and <code>gf_smooth</code> to show the trend (loess fit).</li>
<li>The default is to not show a band (<code>interval = "none"</code>). In the current example, we are showing the confidence intervals around the predicted fitted values.</li>
</ol>
</div>
</div>
<p>We can plot, on the same panel, the relationship between maternal weight and breast-milk intake by sex.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>kfm <span class="sc">%&gt;%</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gf_point</span>(dl.milk <span class="sc">~</span> mat.weight, </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">pch =</span> <span class="sc">~</span> sex, <span class="at">col =</span> <span class="sc">~</span> sex) <span class="sc">%&gt;%</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gf_lm</span>(<span class="at">col =</span> <span class="sc">~</span> sex)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig14" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="graphical_files/figure-html/fig-fig14-1.png" class="img-fluid figure-img" width="1800"></p>
<figcaption class="figure-caption">Figure&nbsp;3.14: Relationship between maternal weight and breast-milk intake by sex.</figcaption>
</figure>
</div>
</div>
</div>
<p>The package <code>ggsci</code> contains different palettes of colours for the most important journals (including <em>Nature</em>, <em>Science</em>, <em>NEJM</em>, etc.). Some examples:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>kfm <span class="sc">%&gt;%</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gf_point</span>(dl.milk <span class="sc">~</span> mat.weight, </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">pch =</span> <span class="sc">~</span> sex, <span class="at">col =</span> <span class="sc">~</span> sex) <span class="sc">%&gt;%</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gf_lm</span>(<span class="at">col =</span> <span class="sc">~</span> sex) <span class="sc">%&gt;%</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gf_refine</span>(<span class="fu">scale_color_jama</span>()) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig15" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="graphical_files/figure-html/fig-fig15-1.png" class="img-fluid figure-img" width="1800"></p>
<figcaption class="figure-caption">Figure&nbsp;3.15: Relationship between maternal weight and breast-milk intake by sex. Plot uses palette of colours favoured by JAMA.</figcaption>
</figure>
</div>
</div>
</div>
<p>We already learnt how to construct <em>conditional</em> plots, i.e., to display plots in different panels <em>given</em> a particular condition (using the <code>|</code> symbol).</p>
<blockquote class="blockquote">
<p><strong>Exercise:</strong> Construct a plot showing the relationship between maternal weight and breast-milk intake by sex using one panel for each sex. Include a linear fit to your plot with corresponding bands of confidence intervals.</p>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>kfm <span class="sc">%&gt;%</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gf_point</span>(dl.milk <span class="sc">~</span> mat.weight<span class="sc">|</span>sex, <span class="at">pch =</span> <span class="dv">20</span>) <span class="sc">%&gt;%</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gf_lm</span>(<span class="at">interval =</span> <span class="st">"confidence"</span>, <span class="at">col =</span> <span class="st">"indianred"</span>, </span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">fill =</span> <span class="st">"indianred"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig16" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="graphical_files/figure-html/fig-fig16-1.png" class="img-fluid figure-img" width="1800"></p>
<figcaption class="figure-caption">Figure&nbsp;3.16: Relationship between maternal weight and breast-milk intake by sex.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="scatter-plot-matrix-supplementary-optional-sub-section" class="level3" data-number="3.4.2">
<h3 data-number="3.4.2" class="anchored" data-anchor-id="scatter-plot-matrix-supplementary-optional-sub-section"><span class="header-section-number">3.4.2</span> Scatter plot matrix (supplementary, optional sub-section)</h3>
<p>When we are working with more than two continuous variables and we want to look at potential correlations between them, we can generate a single plot, with all two-variable combinations displayed in different panels. This kind of plot is known as a scatter plot matrix and we can construct them with <code>ggpairs</code> from the package <code>GGally</code>.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p><code>GGally</code> has two other functions that can also construct a scatter plot matrix: <code>ggduo</code> and <code>ggscatmat</code>; <code>ggapairs</code> is however, more flexible.</p>
</div>
</div>
<p>For example, we could be interested in looking at the relationship between pollution, expressed in ozone concentration, in relation with other environmental variables. We load the dataset:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(airquality)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>airquality <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(airquality)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(airquality)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Ozone"   "Solar.R" "Wind"    "Temp"    "Month"   "Day"    </code></pre>
</div>
</div>
<p>Next, we define the variable <code>Month</code> as a factor.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>mes <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"May"</span>, <span class="st">"Jun"</span>, <span class="st">"Jul"</span>, <span class="st">"Aug"</span>, <span class="st">"Sep"</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>airquality <span class="ot">=</span> airquality <span class="sc">%&gt;%</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">Month =</span> <span class="fu">factor</span>(Month, <span class="at">labels =</span> mes)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Function <code>ggpairs</code> does not work well with labelled datasets so we are going to generate a vector with the labels of the variables:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>air <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Temperature (F)"</span>, <span class="st">"Wind (mph)"</span>,</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>         <span class="st">"Radiation (A)"</span>, <span class="st">"Ozone (ppb)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In our first scatter plot matrix, we are going to show also the loess trend:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>airquality <span class="sc">%&gt;%</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggpairs</span>(</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> <span class="dv">4</span><span class="sc">:</span><span class="dv">1</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">lower =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(<span class="st">"smooth_loess"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>,</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">shape =</span> <span class="dv">20</span>, <span class="at">size =</span> <span class="fl">0.9</span>,</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">color =</span> <span class="st">"cadetblue"</span>)),</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">columnLabels =</span> air</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig17" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="graphical_files/figure-html/fig-fig17-1.png" class="img-fluid figure-img" width="1800"></p>
<figcaption class="figure-caption">Figure&nbsp;3.17: Relationship between pollution (ozone) and some environmental variables. Curves show loess trend.</figcaption>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>With option <code>columns</code> we select which columns of the dataset we want to plot. The default (if omitted) is to plot all.</li>
<li>We selected columns from 4 to 1 because we want for <code>Ozone</code> to be displayed on the <span class="math inline">\(y\)</span>-axis.</li>
<li>We use option <code>lower</code> to indicate what we want to plot on the <em>lower</em> diagonal.</li>
<li>We add a loess trend with <code>smooth_loess</code>. For a linear model, we would use <code>smooth</code>.</li>
<li>The diagonal shows the distributions of each variable. For continuous variables, the diagonal displays density plots and for categorical variables shows bar charts.</li>
<li>To understand the plot, focus on the bottom row. In panels of the bottom row, ozone is plotted on the <span class="math inline">\(y\)</span>-axis; first against temperature, next against wind and finally, against solar radiation.</li>
</ol>
</div>
</div>
<p>The <code>airquality</code> dataset includes a categorical variable, <code>Month</code> that we can use to stratify continuous variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>airquality <span class="sc">%&gt;%</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggpairs</span>(</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> <span class="dv">4</span><span class="sc">:</span><span class="dv">1</span>, </span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">color =</span> Month, <span class="at">alpha =</span> <span class="fl">0.8</span>),</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">lower =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(<span class="st">"points"</span>,</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">shape =</span> <span class="dv">20</span>, <span class="at">size =</span> <span class="dv">1</span>)),</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">upper =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(<span class="st">"cor"</span>, <span class="at">size =</span> <span class="dv">2</span>)),</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">columnLabels =</span> air</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig18" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="graphical_files/figure-html/fig-fig18-1.png" class="img-fluid figure-img" width="1800"></p>
<figcaption class="figure-caption">Figure&nbsp;3.18: Relationship between pollution (ozone) and some environmental variables by month.</figcaption>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>We use <code>mapping</code>, a function from <code>ggplot2</code> to stratify by <code>Month</code>. Please notice that <code>ggplot2</code> does not uses formulas, hence the lack of the tilde (<code>~</code>).</li>
<li>We used option <code>"points"</code> as to display only symbols with no added fit.</li>
<li>If we use <code>"smooth"</code> or <code>"smooth_loess"</code> we would have added a fit for each month making the plot harder to interpret.</li>
<li>We included the option <code>upper</code> only to decrease the size of the font to <code>size = 2</code>, so the information of the correlations fit well within the panels.</li>
</ol>
</div>
</div>
<p>If our data is labelled, we need to remove the labels for <code>ggpair</code> to work. As usual, as long as we don’t assign the commands of the pipe-workflow to a variable (data frame) then our alterations will not be stored and will have only a local effect.</p>
<p>For example, let’s say we would like to look at relationships within the <code>kfm</code> dataset. In the following code, we remove the labels and we change the reference level of sex, just to display boys in blue and girls in pink.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>kfm <span class="sc">%&gt;%</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">remove_all_labels</span>() <span class="sc">%&gt;%</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">sex =</span> <span class="fu">relevel</span>(sex, <span class="at">ref =</span> <span class="st">"Girl"</span>)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggpairs</span>(</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> <span class="fu">c</span>(<span class="dv">4</span><span class="sc">:</span><span class="dv">7</span>, <span class="dv">2</span>),</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">color =</span> sex, <span class="at">alpha =</span> <span class="fl">0.8</span>),</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">lower =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(<span class="st">"points"</span>,</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">shape =</span> <span class="dv">20</span>, <span class="at">size =</span> <span class="dv">1</span>)),</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">upper =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(<span class="st">"cor"</span>, <span class="at">size =</span> <span class="dv">3</span>)),</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">columnLabels =</span> <span class="fu">c</span>(</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Child weight"</span>,</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Milk-substitute"</span>,</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Maternal weight"</span>,</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Maternal height"</span>,</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Breast-milk"</span></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig19" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="graphical_files/figure-html/fig-fig19-1.png" class="img-fluid figure-img" width="1800"></p>
<figcaption class="figure-caption">Figure&nbsp;3.19: Relationship between breast-milk intake (dl/day) and other variables from the <code>kfm</code> dataset.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="correlation-plots" class="level3" data-number="3.4.3">
<h3 data-number="3.4.3" class="anchored" data-anchor-id="correlation-plots"><span class="header-section-number">3.4.3</span> Correlation plots</h3>
<p>An alternative to scatter-plot matrices are correlation plots:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>airquality <span class="sc">%&gt;%</span> </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span> <span class="fu">c</span>(Month, Day)) <span class="sc">%&gt;%</span> </span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">correlation</span>(<span class="at">rename =</span> air, <span class="at">method =</span> <span class="st">"spearman"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>() <span class="sc">%&gt;%</span> <span class="fu">plot</span>(<span class="at">show_data =</span> <span class="st">"points"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gf_theme</span>(<span class="fu">theme_lucid</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig20" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="graphical_files/figure-html/fig-fig20-1.png" class="img-fluid figure-img" width="1800"></p>
<figcaption class="figure-caption">Figure&nbsp;3.20: Correlation plot of continuous varialbes from the <code>airquality</code> dataset.</figcaption>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>Correlation plots have the disadvantage of not showing the actual relationship between the variables, nor to their distributions but only a visual representation of the correlation matrix.</li>
<li>Correlation is covered in the regression section.</li>
</ol>
</div>
</div>
</section>
<section id="line-charts" class="level3" data-number="3.4.4">
<h3 data-number="3.4.4" class="anchored" data-anchor-id="line-charts"><span class="header-section-number">3.4.4</span> Line charts</h3>
<p>Sometimes, we don’t want to fit a trend or a linear model, but to actually connect all observations. With <code>gf_path</code> we connect observations in the order in which they appear in the data, whereas with <code>gf_line</code> we connect them in the order of the variable on the <span class="math inline">\(x\)</span>-axis.</p>
<p>Perhaps, the best example when we want to connect observations is when we are working with time series data.</p>
<p>Download the file <em>fluraw.csv</em> from Moodle, save it on your <em>data</em> directory and load it to the session.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>flu <span class="ot">=</span> <span class="fu">read_csv</span>(<span class="st">"data/fluraw.csv"</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(flu)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
  week       child young   mid   old
  &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 1957-08-25     0     0     1     1
2 1957-09-01     0     2     6     1
3 1957-09-08     0     2     4     2
4 1957-09-15    23    73    63    11
5 1957-09-22    63   208   173    41
6 1957-09-29    73   207   171    27</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>flu <span class="ot">=</span> flu <span class="sc">%&gt;%</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">var_labels</span>(</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">week =</span> <span class="st">"Date"</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The data frame is recorded in what is known as <em>wide</em> format. We will use the function <code>pivot_longer</code> from <code>dplyr</code> to transform it to <em>long</em> format.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>flu_melt <span class="ot">=</span> flu <span class="sc">%&gt;%</span> </span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="sc">!</span>week,</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"agegrp"</span>,</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"cases"</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>flu_melt <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
  week       agegrp cases
  &lt;date&gt;     &lt;chr&gt;  &lt;dbl&gt;
1 1957-08-25 child      0
2 1957-08-25 young      0
3 1957-08-25 mid        1
4 1957-08-25 old        1
5 1957-09-01 child      0
6 1957-09-01 young      2</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>We select the columns that we want to rearrange in <code>cols</code>. With <code>!week</code>, we are making a negative selection (read as <em>not week</em>).</li>
<li>The name of the new categorical variable is gen to <code>names_to</code>. The names of the columns are used as levels of the variable.</li>
<li>The actual values are stored in another variable, which name can be given at <code>values_to</code>.</li>
</ol>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>flu_melt <span class="sc">%&gt;%</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gf_line</span>(cases <span class="sc">~</span> week, <span class="at">col =</span> <span class="sc">~</span> agegrp, <span class="at">size =</span> <span class="fl">0.8</span>) <span class="sc">%&gt;%</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gf_labs</span>(<span class="at">col =</span> <span class="st">"Age group"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gf_refine</span>(<span class="fu">scale_color_npg</span>()) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig21" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="graphical_files/figure-html/fig-fig21-1.png" class="img-fluid figure-img" width="1800"></p>
<figcaption class="figure-caption">Figure&nbsp;3.21: Dynamics of reported influenza cases by age group, in the 1957 pandemic in England and Wales.</figcaption>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>With option <code>size</code> we can modify the width of the lines.</li>
<li>In this example, instead of labelling the data, I specified the names of the axis as part of the plot.</li>
<li>The last line of code is optional and it uses the palette of colours preferred by <em>Nature</em> (<em>Nature Publishing Group</em>).</li>
</ol>
</div>
</div>
</section>
<section id="kaplan-meier-plots" class="level3" data-number="3.4.5">
<h3 data-number="3.4.5" class="anchored" data-anchor-id="kaplan-meier-plots"><span class="header-section-number">3.4.5</span> Kaplan-Meier plots</h3>
<p>Step plots are a variation of line charts in which the lines connect observations by steps instead of direct lines. The best example of step plots are those used in survival analysis as proposed by Kaplan and Meier.</p>
<p>For our example, we will use data about survival in patients with advanced lung cancer. We load the <code>survival</code> package to generate the information that we need to make a Kaplan-Meier plot. After loading the dataset, we transform variable <code>sex</code> to a factor.</p>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Caution
</div>
</div>
<div class="callout-body-container callout-body">
<p>For this tutorial, we are not interested in the modelling, only on constructing and interpreting the plot.</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(cancer, <span class="at">package =</span> <span class="st">"survival"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>lung <span class="ot">=</span> cancer <span class="sc">%&gt;%</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">Sex =</span> <span class="fu">factor</span>(sex, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Male"</span>, <span class="st">"Female"</span>))</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we estimate survival stratified by sex:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>surv_fit <span class="ot">=</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(time, status) <span class="sc">~</span> Sex, <span class="at">data =</span> lung)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>surv_fit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call: survfit(formula = Surv(time, status) ~ Sex, data = lung)

             n events median 0.95LCL 0.95UCL
Sex=Male   138    112    270     212     310
Sex=Female  90     53    426     348     550</code></pre>
</div>
</div>
<p>We can use <code>autoplot</code> to construct the Kaplan-Meier plot:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(surv_fit) <span class="sc">%&gt;%</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gf_labs</span>(<span class="at">x =</span> <span class="st">"Time (days)"</span>, <span class="at">y =</span> <span class="st">"Survival"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig22" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="graphical_files/figure-html/fig-fig22-1.png" class="img-fluid figure-img" width="1800"></p>
<figcaption class="figure-caption">Figure&nbsp;3.22: Kaplan-Meir plot for survival in patients with advanced lung cancer.</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="comparing-groups" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="comparing-groups"><span class="header-section-number">3.5</span> Comparing groups</h2>
<p>Many times, we are interested in comparing groups, for example:</p>
<ul>
<li>treatment vs control</li>
<li>cases vs control</li>
<li>drug A vs drug B</li>
<li>females vs males</li>
</ul>
<p>In these examples, the groups or cohorts represent the <em>explanatory</em> (exposure) variable. If the outcome is continuous, then we are interested in comparing distributions and/or a measure of central tendency.</p>
<section id="box-plots" class="level3" data-number="3.5.1">
<h3 data-number="3.5.1" class="anchored" data-anchor-id="box-plots"><span class="header-section-number">3.5.1</span> Box plots</h3>
<p>When we are comparing continuous variables, between two or more groups, box plots are the best option, particularly if the number of observations in the groups is relatively large (<span class="math inline">\(\geq\)</span> 30).</p>
<p>We are going to use the function <code>box_plot</code> from the <code>pubh</code> package to construct box plots.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>wcgs <span class="sc">%&gt;%</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">box_plot</span>(chol <span class="sc">~</span> chd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig23" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="graphical_files/figure-html/fig-fig23-1.png" class="img-fluid figure-img" width="1800"></p>
<figcaption class="figure-caption">Figure&nbsp;3.23: Box plots of blood cholesterol by coronary heart disease (CHD) event from the WCGS dataset.</figcaption>
</figure>
</div>
</div>
</div>
<p>In the previous figure the presence of an outlier is clear. If we would like to remove that outlier, we would need to declare that in the report. For demonstration purposes, if we do not want to show the outlier in the plot, we have the option to <code>filter</code> the data as shown in the following code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>wcgs <span class="sc">%&gt;%</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(chol <span class="sc">&lt;</span> <span class="dv">500</span>) <span class="sc">%&gt;%</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">copy_labels</span>(wcgs) <span class="sc">%&gt;%</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">box_plot</span>(chol <span class="sc">~</span> chd, <span class="at">fill =</span> <span class="st">"thistle3"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig24" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="graphical_files/figure-html/fig-fig24-1.png" class="img-fluid figure-img" width="1800"></p>
<figcaption class="figure-caption">Figure&nbsp;3.24: Box plots of blood cholesterol by coronary heart disease (CHD) event from the WCGS dataset. A single outlier from the CHD group with a cholesterol concentration of 675 mg/dl is not shown for group comparison purposes.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="significant-lines-supplementary-optional-sub-section" class="level3" data-number="3.5.2">
<h3 data-number="3.5.2" class="anchored" data-anchor-id="significant-lines-supplementary-optional-sub-section"><span class="header-section-number">3.5.2</span> Significant lines (supplementary, optional sub-section)</h3>
<blockquote class="blockquote">
<p><strong>Exercise:</strong> Construct a plot comparing the distributions of breast-milk intake (<code>dl.milk</code>) by sex from the <code>kfm</code> data set.</p>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>kfm <span class="sc">%&gt;%</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">box_plot</span>(dl.milk <span class="sc">~</span> sex)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig25" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="graphical_files/figure-html/fig-fig25-1.png" class="img-fluid figure-img" width="1800"></p>
<figcaption class="figure-caption">Figure&nbsp;3.25: Comparison of breast-milk intake by sex.</figcaption>
</figure>
</div>
</div>
</div>
<p>We can use box plots to show the results of our analysis. It happens that there is a significant difference in the mean value of breast-milk intake between boys and girls (we do not need to worry how to test this, yet). In our final report, if we would like to include a figure to show this difference, we can <em>draw</em> a line over the groups that we are comparing and <em>type</em> an asterisk to indicate the difference. To do that, we can use <code>gf_star</code> from the <code>pubh</code> package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>kfm <span class="sc">%&gt;%</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">box_plot</span>(dl.milk <span class="sc">~</span> sex) <span class="sc">%&gt;%</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gf_star</span>(<span class="at">x1 =</span> <span class="dv">1</span>, <span class="at">y1 =</span> <span class="fl">10.9</span>, <span class="at">x2 =</span> <span class="dv">2</span>, <span class="at">y2 =</span> <span class="dv">11</span>, <span class="at">y3 =</span> <span class="fl">11.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig26" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="graphical_files/figure-html/fig-fig26-1.png" class="img-fluid figure-img" width="1800"></p>
<figcaption class="figure-caption">Figure&nbsp;3.26: Comparison of breast-milk intake by sex (<span class="math inline">\(^*p\)</span> = 0.035, <span class="math inline">\(t\)</span>-test).</figcaption>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>By default, the centre of the boxes is drawn over integer numbers in the <span class="math inline">\(x\)</span>-axis, starting with one.</li>
<li>We are providing points of reference to draw the line with <code>gf_star</code>.</li>
<li><code>gf_star</code> draws a horizontal line from coordinate <span class="math inline">\((x_1, y_2)\)</span> to coordinate <span class="math inline">\((x_2, y_2)\)</span>. Draws vertical lines below the horizontal line, towards data, from <span class="math inline">\((x_1, y_2)\)</span> to <span class="math inline">\((x_1, y_1)\)</span> and from <span class="math inline">\((x_2, y_2)\)</span> to <span class="math inline">\((x_2, y_1)\)</span>. Finally, adds text above the horizontal line, at the mid point between <span class="math inline">\(x_1\)</span> and <span class="math inline">\(x_2\)</span>, at height <span class="math inline">\(y_3\)</span>.</li>
</ol>
</div>
</div>
<p>It is possible to show the actual <span class="math inline">\(p\)</span>-value in the plot. We can also, keep adding <em>layers</em> to the plot; for example, we can show all the observations, which we will <em>jitter</em> on the <span class="math inline">\(x\)</span>-axis, so they can be better appreciated:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>kfm <span class="sc">%&gt;%</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">box_plot</span>(dl.milk <span class="sc">~</span> sex, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gf_jitter</span>(dl.milk <span class="sc">~</span> sex, <span class="at">width =</span> <span class="fl">0.1</span>, <span class="at">height =</span> <span class="dv">0</span>, </span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">alpha =</span> <span class="fl">0.8</span>, <span class="at">pch =</span> <span class="dv">20</span>, <span class="at">size =</span> <span class="fl">0.6</span>) <span class="sc">%&gt;%</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gf_star</span>(<span class="dv">1</span>, <span class="fl">10.9</span>, <span class="dv">2</span>, <span class="dv">11</span>, <span class="fl">11.4</span>, </span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend =</span> <span class="st">'p = 0.035'</span>, <span class="at">size =</span> <span class="dv">3</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig27" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="graphical_files/figure-html/fig-fig27-1.png" class="img-fluid figure-img" width="1800"></p>
<figcaption class="figure-caption">Figure&nbsp;3.27: Comparison of breast-milk intake by sex.</figcaption>
</figure>
</div>
</div>
</div>
<p>Package <code>ggpubr</code> includes a function, <code>stat_compare_means</code> that automatically calculates coordinates to show the results of the hypothesis testing. In that sense, it’s easier to use than <code>gf_star</code> but it’s less flexible.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p><code>ggpubr</code> does not work with formulas, instead, shares the same syntax of <code>ggplot2</code> so layers are added with <code>+</code> instead of <code>%&gt;%</code>.</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>kfm <span class="sc">%&gt;%</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">box_plot</span>(dl.milk <span class="sc">~</span> sex, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gf_jitter</span>(dl.milk <span class="sc">~</span> sex, <span class="at">width =</span> <span class="fl">0.1</span>, <span class="at">height =</span> <span class="dv">0</span>, </span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">alpha =</span> <span class="fl">0.8</span>, <span class="at">pch =</span> <span class="dv">20</span>, <span class="at">size =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_compare_means</span>(<span class="at">comparisons =</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>)), </span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">method =</span> <span class="st">'t.test'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig28" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="graphical_files/figure-html/fig-fig28-1.png" class="img-fluid figure-img" width="1800"></p>
<figcaption class="figure-caption">Figure&nbsp;3.28: Comparison of breast-milk intake by sex.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="strip-charts" class="level3" data-number="3.5.3">
<h3 data-number="3.5.3" class="anchored" data-anchor-id="strip-charts"><span class="header-section-number">3.5.3</span> Strip charts</h3>
<p>When we want to compare groups and the number of observations is relatively small (<span class="math inline">\(n\)</span> &lt; 30) box plots are not good. It is better to show all data in a variation of a scatter plot known as strip plot or strip chart.</p>
<p>We will use the data <code>energy</code> from the <code>ISwR</code> package about the energy expenditure of lean and obese women.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(energy, <span class="at">package =</span> <span class="st">"ISwR"</span>)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(energy)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  expend stature
1   9.21   obese
2   7.53    lean
3   7.48    lean
4   8.08    lean
5   8.09    lean
6  10.15    lean</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>energy <span class="ot">=</span> energy <span class="sc">%&gt;%</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">var_labels</span>(</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">expend =</span> <span class="st">"Energy expenditure (MJ)"</span>,</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">stature =</span> <span class="st">"Stature"</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(energy, <span class="st">"data/energy.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>energy <span class="sc">%&gt;%</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gf_jitter</span>(expend <span class="sc">~</span> stature, <span class="at">width =</span> <span class="fl">0.1</span>, </span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">height =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig29" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="graphical_files/figure-html/fig-fig29-1.png" class="img-fluid figure-img" width="1800"></p>
<figcaption class="figure-caption">Figure&nbsp;3.29: Comparison of energy between obese and lean women.</figcaption>
</figure>
</div>
</div>
</div>
<p>It is easier to compare the groups if we include error bars showing the 95% confidence interval (CI) around the mean. To do that, we can use the function <code>strip_error</code> from the <code>pubh</code> package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>energy <span class="sc">%&gt;%</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">strip_error</span>(expend <span class="sc">~</span> stature, <span class="at">size =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig30" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="graphical_files/figure-html/fig-fig30-1.png" class="img-fluid figure-img" width="1800"></p>
<figcaption class="figure-caption">Figure&nbsp;3.30: Comparison of energy expenditure between lean and obese women. Error bars represent bootstrap 95% CI.</figcaption>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>In <code>strip_error</code>, the argument <code>size</code> refers to the size of the symbols used to plot the individual observations.</p>
</div>
</div>
<p>The rationale to add a significant line is the same as for box plots.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>energy <span class="sc">%&gt;%</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">strip_error</span>(expend <span class="sc">~</span> stature, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gf_star</span>(<span class="dv">1</span>, <span class="fl">13.3</span>, <span class="dv">2</span>, <span class="fl">13.4</span>, <span class="fl">13.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig31" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="graphical_files/figure-html/fig-fig31-1.png" class="img-fluid figure-img" width="1800"></p>
<figcaption class="figure-caption">Figure&nbsp;3.31: Comparison of energy expenditure between lean and obese women. Error bars represent 95% bootstrap CI (<span class="math inline">\(^*p\)</span> = 0.001, <span class="math inline">\(t\)</span>-test).</figcaption>
</figure>
</div>
</div>
</div>
<p>We can also construct strip plots with error bars, by groups.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>birthwt <span class="sc">%&gt;%</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">strip_error</span>(bwt <span class="sc">~</span> smoke, <span class="at">pch =</span> <span class="sc">~</span> Race, <span class="at">col =</span> <span class="sc">~</span> Race) <span class="sc">%&gt;%</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gf_refine</span>(<span class="fu">scale_color_jama</span>()) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig32" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="graphical_files/figure-html/fig-fig32-1.png" class="img-fluid figure-img" width="1800"></p>
<figcaption class="figure-caption">Figure&nbsp;3.32: Comparison of birth weight of babies born from mothers with different smoking status by race. Error bars represent 95% bootstrap CI.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="violin-plots-supplementary-optional-sub-section" class="level3" data-number="3.5.4">
<h3 data-number="3.5.4" class="anchored" data-anchor-id="violin-plots-supplementary-optional-sub-section"><span class="header-section-number">3.5.4</span> Violin plots (supplementary, optional sub-section)</h3>
<p>Violin plots combine ideas from both density plots and box plots. They show density distributions and can incorporate other elements, like strip charts.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>kfm <span class="sc">%&gt;%</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gf_violin</span>(dl.milk <span class="sc">~</span> sex, <span class="at">fill =</span> <span class="sc">~</span> sex, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gf_jitter</span>(dl.milk <span class="sc">~</span> sex, <span class="at">width =</span> <span class="fl">0.1</span>, <span class="at">height =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig33" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="graphical_files/figure-html/fig-fig33-1.png" class="img-fluid figure-img" width="1800"></p>
<figcaption class="figure-caption">Figure&nbsp;3.33: Comparison of breast-milk intake distributions by sex.</figcaption>
</figure>
</div>
</div>
</div>
<p>For larger datasets, we can add summary of statistics using error bars indicating the mean and 95% CI around mean values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>wcgs <span class="sc">%&gt;%</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gf_violin</span>(sbp <span class="sc">~</span> chd, <span class="at">fill =</span> <span class="sc">~</span> beh_pat, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gf_summary</span>(<span class="at">fun.data =</span> <span class="st">"mean_cl_boot"</span>, </span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">geom =</span> <span class="st">'pointrange'</span>, <span class="at">fatten =</span> <span class="dv">1</span>,</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.9</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig34" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="graphical_files/figure-html/fig-fig34-1.png" class="img-fluid figure-img" width="1800"></p>
<figcaption class="figure-caption">Figure&nbsp;3.34: Comparison of systolic blood pressure (SBP) by coronary heart disease event, stratified by behaviour pattern.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="bar-charts" class="level3" data-number="3.5.5">
<h3 data-number="3.5.5" class="anchored" data-anchor-id="bar-charts"><span class="header-section-number">3.5.5</span> Bar charts</h3>
<p>Bar charts or bar plots are used, most of the time, to display information from a table graphically. Therefore, for publications are not the best option as a table uses less space and contains better information.</p>
<p>For example, we can use <code>sjplot</code> from the <code>sjPlot</code> package to graphically compare the frequency distributions of babies with low birth weights by race.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>birthwt <span class="sc">%&gt;%</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(race, low) <span class="sc">%&gt;%</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sjplot</span>(<span class="at">show.values =</span> <span class="cn">FALSE</span>, <span class="at">show.prc =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig35" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="graphical_files/figure-html/fig-fig35-1.png" class="img-fluid figure-img" width="1800"></p>
<figcaption class="figure-caption">Figure&nbsp;3.35: Distribution of lower birth weights by race.</figcaption>
</figure>
</div>
</div>
</div>
<p>Same plot but using <code>gf_counts</code> from <code>ggformula</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>birthwt <span class="sc">%&gt;%</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gf_counts</span>(<span class="sc">~</span> race, <span class="at">fill =</span> <span class="sc">~</span> low, <span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">%&gt;%</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gf_refine</span>(<span class="fu">scale_fill_lancet</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig36" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="graphical_files/figure-html/fig-fig36-1.png" class="img-fluid figure-img" width="1800"></p>
<figcaption class="figure-caption">Figure&nbsp;3.36: Distribution of lower birth weights by race.</figcaption>
</figure>
</div>
</div>
</div>
<p>We had already shown the use of box plots. In box plots, we are comparing medians and distributions instead of means. It is because of that limitation that some authors favour the use of bar charts in which the height of the bars represent mean values for each group and error bars are included to show dispersion. For <em>inferential statistics</em> we would show either standard errors or 95% CIs.</p>
<p>In the <code>pubh</code> package there is a function that automatically does that.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>kfm <span class="sc">%&gt;%</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bar_error</span>(dl.milk <span class="sc">~</span> sex) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig37" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="graphical_files/figure-html/fig-fig37-1.png" class="img-fluid figure-img" width="1800"></p>
<figcaption class="figure-caption">Figure&nbsp;3.37: Comparison of breast-milk intake between boys and girls. Bar heights are mean values and error bars represent 95% CIs (bootstrap).</figcaption>
</figure>
</div>
</div>
</div>
<p>As it was the case with strip plots, we can also construct bar plots stratified by a second factor:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>birthwt <span class="sc">%&gt;%</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bar_error</span>(bwt <span class="sc">~</span> smoke<span class="sc">|</span>Race, <span class="at">fill =</span> <span class="st">'plum3'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig38" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="graphical_files/figure-html/fig-fig38-1.png" class="img-fluid figure-img" width="1800"></p>
<figcaption class="figure-caption">Figure&nbsp;3.38: Comparison of birth weights of babies born from mothers with different smoking status, stratified by race. Height of bars represent mean birth weight values for each group and error bars, 95% CI around those mean values.</figcaption>
</figure>
</div>
</div>
</div>
<p>It is also possible to play with <code>col</code> and <code>fill</code> and to add more layers, like <code>gf_star</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">=</span> birthwt <span class="sc">%&gt;%</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bar_error</span>(bwt <span class="sc">~</span> smoke, <span class="at">col =</span> <span class="sc">~</span> Race, </span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">fill =</span> <span class="st">'white'</span>, <span class="at">title =</span> <span class="st">"(a)"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gf_refine</span>(<span class="fu">scale_color_lancet</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">axis_labs</span>()</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">=</span> birthwt <span class="sc">%&gt;%</span></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bar_error</span>(bwt <span class="sc">~</span> smoke, <span class="at">fill =</span> <span class="sc">~</span> Race, </span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">title =</span> <span class="st">"(b)"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">axis_labs</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gf_refine</span>(<span class="fu">scale_fill_jama</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gf_star</span>(<span class="at">x1=</span><span class="fl">0.8</span>, <span class="at">x2=</span><span class="fl">1.2</span>, <span class="at">y1=</span><span class="dv">3800</span>, <span class="at">y2=</span><span class="dv">3900</span>, <span class="at">y3=</span><span class="dv">3950</span>)</span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(<span class="fu">list</span>(p1, p2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig39" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="graphical_files/figure-html/fig-fig39-1.png" class="img-fluid figure-img" width="1800"></p>
<figcaption class="figure-caption">Figure&nbsp;3.39: Comparison of birth weights of babies born from mothers with different smoking status, stratified by race. Height of bars represent mean birth weight values for each group and error bars, 95% CI around those mean values. (a) Example showing the effect of col by group. (b) Example showing the effect of fill by group (<span class="math inline">\(^*p\)</span> &lt; 0.05).</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="exporting-figures" class="level2" data-number="3.6">
<h2 data-number="3.6" class="anchored" data-anchor-id="exporting-figures"><span class="header-section-number">3.6</span> Exporting figures</h2>
<p>When you are working in your <code>RMarkdown</code> documents, there is no need to export figures, and everything is done automatically.</p>
<p>When you run your commands interactively, plots are shown in the <em>Plots</em> tab. The easiest way to export them is to click on <code>Export</code> and select <code>Save as PDF</code>. PDF figures can be inserted in Word, Power Point, Keynote, Pages, etc. The plot will be saved as shown on your viewer, not always the best idea. Word and Power Point work better with <code>.png</code> figures.</p>
<section id="postscript-figures" class="level3" data-number="3.6.1">
<h3 data-number="3.6.1" class="anchored" data-anchor-id="postscript-figures"><span class="header-section-number">3.6.1</span> Postscript figures</h3>
<p>We have more control if we export the file using the function <code>pdf</code> than exporting them with the viewer. When we use this option, the instruction could be part of our script file. We need three sections of code to export a figure this way:</p>
<ol type="1">
<li>The first section creates the file and defines the size of the plot. The units are in inches.</li>
<li>The second section makes the plot.</li>
<li>The third section is used to close the device. Is a way to tell the system that we have finished the plot.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pdf</span>(<span class="st">"figures/fig6.pdf"</span>, <span class="at">height =</span> <span class="dv">4</span>, <span class="at">width =</span> <span class="fl">5.3</span>, <span class="at">pointsize =</span> <span class="dv">9</span>)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>birthwt <span class="sc">%&gt;%</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gf_density</span>(<span class="sc">~</span> bwt<span class="sc">|</span>smoke, <span class="at">fill =</span> <span class="sc">~</span> race, <span class="at">alpha=</span><span class="fl">0.3</span>)</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For publications, is more common that publishers will ask for a <code>.eps</code> file (encapsulated postscript). The command is very similar.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">postscript</span>(<span class="st">"figures/fig15.eps"</span>, <span class="at">height =</span> <span class="dv">4</span>, <span class="at">width =</span> <span class="fl">5.3</span>, </span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">pointsize =</span> <span class="dv">9</span>, <span class="at">horizontal =</span> <span class="cn">FALSE</span>)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>kfm <span class="sc">%&gt;%</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gf_point</span>(dl.milk <span class="sc">~</span> mat.weight, <span class="at">pch =</span> <span class="sc">~</span> sex, <span class="at">col =</span> <span class="sc">~</span> sex) <span class="sc">%&gt;%</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gf_lm</span>(<span class="at">col =</span> <span class="sc">~</span> sex) <span class="sc">%&gt;%</span></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gf_refine</span>(<span class="fu">scale_color_jama</span>())</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


<div id="refs" class="references csl-bib-body hanging-indent" role="list" style="display: none">
<div id="ref-iswr" class="csl-entry" role="listitem">
Dalgaard, P. (2008), <em>Introductory statistics with r</em>, Springer.
</div>
</div>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
      }
    }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./descriptives.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Descriptive Statistics</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./estimation.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Introduction to Inferential Statistics</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">© Copyright 2023, Josie Athens. All rights reserved.</div>
  </div>
</footer>



</body></html>